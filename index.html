<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>24H Astral Watch • Moon Phase</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at bottom, #02010a, #000);
    overflow: hidden;
}
canvas {
    display: block;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ================= STAR FIELD ================= */
const stars = [];
for (let i = 0; i < 260; i++) {
    stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 1.4 + 0.2,
        a: Math.random() * Math.PI * 2
    });
}

function drawStars() {
    for (let s of stars) {
        s.a += 0.01;
        ctx.fillStyle = `rgba(255,255,255,${0.3 + Math.sin(s.a)*0.3})`;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
    }
}

/* ================= MOON PHASE ================= */
function getMoonPhase(date) {
    const lp = 2551443; // lunar period in seconds
    const newMoon = new Date("2000-01-06T18:14:00Z").getTime();
    const phase = ((date.getTime() - newMoon) / 1000) % lp;
    return phase / lp; // 0..1
}

function drawMoonPhase(x, y, r, phase) {
    ctx.save();
    ctx.translate(x, y);

    // Moon base
    ctx.fillStyle = "#fff";
    ctx.beginPath();
    ctx.arc(0, 0, r, 0, Math.PI * 2);
    ctx.fill();

    ctx.globalCompositeOperation = "destination-out";

    ctx.beginPath();
    const k = Math.cos(phase * Math.PI * 2);
    ctx.ellipse(k * r, 0, r, r, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.globalCompositeOperation = "source-over";
    ctx.restore();
}

/* ================= NOISE ================= */
function drawNoise() {
    const imageData = ctx.createImageData(canvas.width, canvas.height);
    for (let i = 0; i < imageData.data.length; i += 4) {
        const v = Math.random() * 25;
        imageData.data[i] = v;
        imageData.data[i+1] = v;
        imageData.data[i+2] = v;
        imageData.data[i+3] = 25;
    }
    ctx.putImageData(imageData, 0, 0);
}

/* ================= GLITCH ================= */
function drawGlitch() {
    if (Math.random() < 0.04) {
        const y = Math.random() * canvas.height;
        const h = Math.random() * 8 + 2;
        ctx.drawImage(
            canvas,
            0, y, canvas.width, h,
            Math.random() * 20 - 10, y,
            canvas.width, h
        );
    }
}

/* ================= CLOCK ================= */
function drawClock() {
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const radius = Math.min(cx, cy) * 0.38;

    ctx.save();
    ctx.translate(cx, cy);

    /* Dial */
    const grd = ctx.createRadialGradient(0,0,radius*0.1,0,0,radius);
    grd.addColorStop(0, "#444");
    grd.addColorStop(1, "#111");
    ctx.fillStyle = grd;
    ctx.beginPath();
    ctx.arc(0, 0, radius, 0, Math.PI * 2);
    ctx.fill();

    /* Guilloché */
    ctx.strokeStyle = "rgba(255,255,255,0.08)";
    for (let i = 0; i < 360; i += 2) {
        ctx.save();
        ctx.rotate(i * Math.PI / 180);
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(radius, 0);
        ctx.stroke();
        ctx.restore();
    }

    /* 24H markers */
    ctx.strokeStyle = "#ddd";
    ctx.lineWidth = 3;
    for (let h = 0; h < 24; h++) {
        ctx.save();
        ctx.rotate(h * 15 * Math.PI / 180);
        ctx.beginPath();
        ctx.moveTo(radius * 0.88, 0);
        ctx.lineTo(radius * 0.98, 0);
        ctx.stroke();
        ctx.restore();
    }

    const now = new Date();
    const hours = now.getHours() + now.getMinutes() / 60;
    const minutes = now.getMinutes() + now.getSeconds() / 60;
    const seconds = now.getSeconds() + now.getMilliseconds() / 1000;

    /* Hands */
    ctx.save();
    ctx.rotate(hours * 15 * Math.PI / 180);
    ctx.strokeStyle = "#f0f0f0";
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(-radius * 0.1, 0);
    ctx.lineTo(radius * 0.55, 0);
    ctx.stroke();
    ctx.restore();

    ctx.save();
    ctx.rotate(minutes * 6 * Math.PI / 180);
    ctx.strokeStyle = "#ccc";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(-radius * 0.15, 0);
    ctx.lineTo(radius * 0.75, 0);
    ctx.stroke();
    ctx.restore();

    ctx.save();
    ctx.rotate(seconds * 6 * Math.PI / 180);
    ctx.strokeStyle = "#88f";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(-radius * 0.2, 0);
    ctx.lineTo(radius * 0.85, 0);
    ctx.stroke();
    ctx.restore();

    ctx.fillStyle = "#fff";
    ctx.beginPath();
    ctx.arc(0, 0, 6, 0, Math.PI * 2);
    ctx.fill();

    /* Moon window */
    const phase = getMoonPhase(now);
    drawMoonPhase(0, radius * 0.45, radius * 0.16, phase);

    ctx.restore();
}

/* ================= LOOP ================= */
function animate() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawStars();
    drawClock();
    drawNoise();
    drawGlitch();
    requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
